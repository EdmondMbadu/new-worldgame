<app-navbar
  [sideBarSmall]="true"
  [sideBarBig]="false"
  [email]="auth.currentUser?.email"
  [firstName]="auth.currentUser?.firstName"
  [lastName]="auth.currentUser?.lastName"
  [path]="'home'"
  current="''">
</app-navbar>

<div class="min-h-screen dark:bg-slate-950">
  <!-- ambient glow -->
  <div aria-hidden="true"
       class="pointer-events-none fixed -top-24 -left-24 hidden md:block h-80 w-80 rounded-full
              bg-gradient-to-tr from-violet-500 to-sky-400 opacity-20 blur-3xl"></div>
  <div aria-hidden="true"
       class="pointer-events-none fixed -bottom-28 -right-28 hidden md:block h-[28rem] w-[28rem] rounded-full
              bg-gradient-to-tr from-teal-500 to-emerald-400 opacity-20 blur-3xl"></div>

  <!-- widened container -->
  <div class="mx-auto max-w-7xl px-6 pt-24 pb-10">
    <!-- PROFILE HEADER CARD -->
    <section
      class="relative isolate overflow-visible rounded-3xl border border-slate-200/70 bg-white/70 shadow-xl
             backdrop-blur dark:border-slate-800 dark:bg-slate-900/70">
      <!-- gradient ribbon -->
      <div class="h-28 bg-gradient-to-r from-violet-500/20 via-sky-500/20 to-teal-500/20
                  dark:from-violet-500/15 dark:via-sky-500/15 dark:to-teal-500/15"></div>

      <div class="-mt-12 px-6 pb-6 sm:px-8">
        <div class="flex flex-col gap-6 md:flex-row md:items-center">
          <!-- AVATAR (exclusive rendering) -->
          <div class="relative shrink-0">
            <!-- initials mode -->
            <ng-container *ngIf="avatarMode === 'initials'; else avatarNonInitials">
              <div
                class="grid h-24 w-24 place-items-center rounded-3xl ring-2 ring-white shadow-2xl
                       bg-gradient-to-br from-sky-500 to-violet-600 text-white text-3xl font-semibold
                       dark:ring-slate-900">
                {{ initials }}
              </div>
            </ng-container>

            <!-- photo or silhouette -->
            <ng-template #avatarNonInitials>
              <ng-container *ngIf="avatarMode === 'photo'; else avatarSilhouette">
                <img
                  [src]="profilePicturePath"
                  alt="Profile picture"
                  class="h-24 w-24 rounded-3xl object-cover ring-2 ring-white shadow-2xl
                         dark:ring-slate-900" />
              </ng-container>
              <ng-template #avatarSilhouette>
                <div
                  class="grid h-24 w-24 place-items-center rounded-3xl bg-slate-100 text-slate-400
                         ring-2 ring-white shadow-2xl dark:bg-slate-800 dark:text-slate-500 dark:ring-slate-900">
                  <svg class="h-12 w-12" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                  </svg>
                </div>
              </ng-template>
            </ng-template>
          </div>

          <!-- NAME + META + ACTIONS -->
          <div class="flex-1">
            <div class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
              <div>
                <h1 class="text-2xl font-bold tracking-tight text-slate-900 dark:text-white">
                  <span *ngIf="namePresent">{{ user?.firstName }} {{ user?.lastName }}</span>
                  <span *ngIf="!namePresent">{{ user?.email }}</span>
                </h1>

                <div class="mt-1 text-slate-600 dark:text-slate-300">
                  <span class="text-base">{{ user?.email }}</span>
                </div>

                <div *ngIf="user?.profileCredential" class="mt-2">
                  <span class="inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm
                                border-slate-200 bg-white text-slate-700 shadow-sm
                                dark:border-slate-700 dark:bg-slate-800 dark:text-slate-200">
                    {{ user!.profileCredential }}
                  </span>
                </div>

                <div class="mt-2 text-sm text-slate-500 dark:text-slate-400">
                  {{ user!.followers }} followers · {{ user!.following }} following
                </div>
              </div>

              <div class="mt-2 md:mt-0">
                <button *ngIf="!followingThisUser"
                        (click)="followThisUser()"
                        class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-sky-600 to-teal-600
                               px-5 py-2 text-sm font-medium text-white shadow-md hover:shadow-lg
                               transition active:scale-[.98]">
                  Follow
                </button>
                <button *ngIf="followingThisUser"
                        (click)="UnFollowThisUser()"
                        class="inline-flex items-center gap-2 rounded-full border border-slate-300
                               bg-white px-5 py-2 text-sm font-medium text-slate-700 shadow-sm
                               hover:bg-slate-50 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-200">
                  Unfollow
                </button>
              </div>
            </div>

            <!-- Bio -->
            <p *ngIf="user?.profileDescription"
               class="mt-5 max-w-3xl leading-relaxed text-slate-700 dark:text-slate-300">
              {{ user!.profileDescription }}
            </p>

            <!-- Achievements (no clipping, high z-index) -->
            <div *ngIf="completedSolutions.length > 0" class="mt-6 overflow-visible">
              <h2 class="text-lg font-bold text-slate-900 dark:text-white">Achievements</h2>
              <div class="mt-3 flex flex-wrap items-center gap-4">
                <!-- Solution Completed -->
                <div class="relative">
                  <img (mouseenter)="onHoverImageToggle('solution-completed')"
                       (mouseleave)="onHoverImageToggle('solution-completed')"
                       class="h-16 w-16 rounded-xl border border-slate-200 bg-white p-2 shadow-sm
                              dark:border-slate-700 dark:bg-slate-800"
                       src="../../../assets/img/solution-completed-badge.png"
                       alt="Solution Completed badge" />
                  <div *ngIf="showSolutionCompletedBadge"
                       class="absolute left-20 top-1 z-50 w-72 rounded-xl border border-slate-200 bg-white p-4
                              text-sm shadow-2xl dark:border-slate-700 dark:bg-slate-900">
                    <img class="mb-3 h-24 w-full rounded-lg object-contain"
                         src="../../../assets/img/solution-completed-badge.png" alt="" />
                    <h3 class="mb-1 text-base font-semibold text-slate-900 dark:text-white">
                      Solution Completed
                    </h3>
                    <p class="text-slate-600 dark:text-slate-300">
                      You completed a solution—first milestone toward real-world impact.
                    </p>
                  </div>
                </div>

                <!-- Points -->
                <div class="relative" *ngIf="points !== 0">
                  <img (mouseenter)="onHoverImageToggle('points')"
                       (mouseleave)="onHoverImageToggle('points')"
                       class="h-16 w-16 rounded-full border border-slate-200 bg-white p-2 shadow-sm
                              dark:border-slate-700 dark:bg-slate-800"
                       src="../../../assets/img/nwg-solution-badge.png"
                       alt="Points badge" />
                  <div *ngIf="showSolutionWithPointsBadge"
                       class="absolute left-20 top-1 z-50 w-72 rounded-xl border border-slate-200 bg-white p-4
                              text-sm shadow-2xl dark:border-slate-700 dark:bg-slate-900">
                    <img class="mb-3 h-24 w-full rounded-lg object-contain"
                         src="../../../assets/img/nwg-solution-badge.png" alt="" />
                    <h3 class="mb-1 text-base font-semibold text-slate-900 dark:text-white">
                      You Got Points
                    </h3>
                    <p class="text-slate-600 dark:text-slate-300">
                      Your solution earned points—iterate to reach top scores for the tournament.
                    </p>
                  </div>
                </div>
              </div>
            </div>

          </div> <!-- /meta -->
        </div>
      </div>
    </section>

    <!-- RIGHT COLUMN: Credentials & Highlights -->
    <section class="mt-8 grid grid-cols-1 gap-8 lg:grid-cols-3">
      <div class="lg:col-span-2"></div>
      <aside
        class="rounded-3xl border border-slate-200/70 bg-white/70 p-6 shadow-xl backdrop-blur
               dark:border-slate-800 dark:bg-slate-900/70">
        <h2 class="text-lg font-semibold text-slate-900 dark:text-white">Credentials & Highlights</h2>

        <ul class="mt-4 space-y-4 text-slate-700 dark:text-slate-300">
          <li *ngIf="user!.employement !== ''" class="flex items-start gap-3">
            <svg width="22" height="22" class="mt-0.5 shrink-0 dark:fill-white" viewBox="0 0 512 512">
              <path d="M277.333 0L298.667 21.333V64H426.667V362.667H0V64H128V21.333L149.333 0H277.333Z
                       M42.667 220.935V320H384V220.935C341.375 233.13 298.702 240.759 256 243.809V277.333H170.667V243.809
                       C127.965 240.759 85.292 233.131 42.667 220.935ZM384 106.667H42.667V176.433
                       C99.639 193.933 156.507 202.667 213.333 202.667S327.028 193.933 384 176.433V106.667Z
                       M256 42.667H170.667V64H256V42.667Z"/>
            </svg>
            <span class="font-medium">{{ user!.employement }}</span>
          </li>

          <li *ngIf="user!.education !== ''" class="flex items-start gap-3">
            <svg width="22" height="22" class="mt-0.5 shrink-0 dark:fill-white" viewBox="0 0 1024 1024">
              <path d="M197.8 791.8l60.7-286.9c2.3-11.1-4.7-21.9-15.8-24.3s-21.9 4.7-24.3 15.8l-60.7 286.9
                       c-2.3 11.1 4.7 21.9 15.8 24.3 11.1 2.3 21.9-4.7 24.3-15.8zm571.1-286.8l61.8 287.1c2.4 11.1 13.3 18.1 24.3 15.7
                       11.1-2.4 18.1-13.3 15.7-24.3l-61.8-287.1c-2.4-11.1-13.3-18.1-24.3-15.7-11.1 2.4-18.1 13.3-15.7 24.3z"/>
              <path d="M967.5 386.9L535.9 208.1c-10.6-4.4-30.6-4.4-41.2-.1L57.8 386.9l436.9 178.9c10.6 4.4 30.6 4.3 41.2-.1l431.6-178.8z"/>
            </svg>
            <span class="font-medium">{{ user!.education }}</span>
          </li>

          <li *ngIf="user!.location !== ''" class="flex items-start gap-3">
            <svg width="22" height="22" class="mt-0.5 shrink-0 dark:fill-white" viewBox="0 0 64 64">
              <path d="M32 0C18.7 0 8 10.7 8 24c0 5.7 2.5 10.7 5.3 15L30.4 63.2c.3.5.9.8 1.6.8s1.3-.3 1.6-.8L50.7 39
                       C53.4 35.4 56 29.7 56 24 56 10.7 45.3 0 32 0zM48.1 39L32 61 15.9 39C13.5 35.5 10 29.8 10 24 10 11.8 19.8 2 32 2
                       s22 9.8 22 22c0 5.8-3.7 11.5-5.9 15z"/>
            </svg>
            <span class="font-medium">{{ user!.location }}</span>
          </li>

          <li class="flex items-center gap-3">
            <img class="h-6 w-6 rounded-full" src="../../../assets/img/nwg-solution-badge.png" alt="">
            <span>Points: <strong>{{ points || '__' }}</strong></span>
          </li>

          <li class="flex items-start gap-3">
            <svg width="22" height="22" class="mt-0.5 shrink-0 dark:fill-white" viewBox="0 0 32 32">
              <path d="M28.5 13.8c0-4.6-2.3-8.8-6-11.3l1-1.7c.1-.2.1-.6-.2-.7-.2-.1-.6-.1-.7.2l-1 1.7C19.2 1.6 17.4 1 15.5 1
                       9.7 1 5 5.7 5 11.5c0 3.6 1.8 6.8 4.6 8.7l-1.1 1.9a12.5 12.5 0 0011 1.7V31h-3a.5.5 0 000 1h7a.5.5 0 000-1h-3v-3.5
                       c5.5-.1 11.5-6.2 11.5-13.7zM6.8 11.5c0-5.2 4.3-9.5 9.5-9.5s9.5 4.3 9.5 9.5-4.3 9.5-9.5 9.5-9.5-4.3-9.5-9.5z"/>
            </svg>
            <span>Joined in {{ dateJoined }}</span>
          </li>
        </ul>
      </aside>
    </section>

    <!-- SOLUTIONS -->
    <section class="mt-10">
      <h2 class="text-center text-2xl font-bold text-slate-900 underline underline-offset-8 dark:text-white">
        Solutions ({{ completedSolutions.length }})
      </h2>

      <div class="mt-6 grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4">
        <div *ngFor="let solution of completedSolutions; let i = index"
             class="min-w-0 transition-transform duration-200 hover:scale-[1.01]">
          <app-solution [user]="user" [solution]="solution"></app-solution>
        </div>
      </div>
    </section>
  </div>

  <app-footer class="md:hidden"></app-footer>
</div>

<app-chatbot></app-chatbot>
