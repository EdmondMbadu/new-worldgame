<div class="dark:bg-slate-900 min-h-screen min-w-full">
    <!-- NAVBAR -->
    <app-navbar
      [sideBarSmall]="true"
      [sideBarBig]="false"
      [email]="auth.currentUser.email"
      [firstName]="auth.currentUser.firstName"
      [lastName]="auth.currentUser.lastName"
      path="home"
      current="">
    </app-navbar>
  
    <!-- TIMELINE / STEPS HEADER (centered) -->
    <!-- <div class="mt-20 container px-32 flex flex-row mx-auto justify-center">
      <ol class="items-center sm:flex">
        <li *ngFor="let step of steps; let i = index" class="relative mb-6 sm:mb-0">
          <div class="flex items-center">
            
            <div  
              (click)="goBackAndForthTimeLine(i)"
              
              class="z-10 flex items-center justify-center w-32 rounded-full shrink-0 cursor-pointer mt-4">
              
              <span
              [ngClass]="{'active': isCurrentStep(i)}"
                class="flex items-center justify-center w-16 h-16 border border-blue-600
                       rounded-full font-bold shrink-0 dark:border-blue-500 dark:text-white">
                {{ i + 1 }}
              </span>
              <div 
            *ngIf="i < steps.length-1 " 
            class="hidden sm:flex w-32 h-1 bg-gray-300 dark:bg-gray-700">
           
          </div>
          <div 
          *ngIf="i == steps.length-1 " 
          class="hidden sm:flex w-32 h-1 bg-white dark:bg-slate-900"></div>

            </div>
  
            
            <div class="hidden sm:flex w-full {{timelineDisplay[i]}} dark:bg-gray-700"></div>
          </div>
  
         
         
        </li>
      </ol>
    </div> -->
    <!-- TIMELINE / STEPS HEADER (centered) -->
<div class="mt-20 container px-32 flex flex-row mx-auto justify-center">
  <ol class="flex items-center space-x-0">
    <li *ngFor="let step of steps; let i = index" class="flex items-center relative">

      <!-- Line BEFORE image (touches image directly) -->
      <div 
        *ngIf="i !== 0"
        class="w-6 sm:w-24 h-1 transition-all duration-300"
        [ngClass]="isCurrentStep(i) ? 'bg-red-500' : 'bg-gray-300 dark:bg-gray-700'">
      </div>

      <!-- Step container (image + title, vertically stacked) -->
      <div class="flex flex-col items-center text-center">

        <!-- Image with red glow if current -->
        <div 
          (click)="goBackAndForthTimeLine(i)"
          class="z-10 flex items-center justify-center cursor-pointer transition-all duration-300"
          [ngClass]="isCurrentStep(i) ? 'ring-4 ring-red-500 rounded-full shadow-lg shadow-red-500/40' : ''">
          
          <img
            [src]="'../../../assets/img/step-' + (i + 1) + '.png'"
            alt="Step {{ i + 1 }} image"
            class="w-36 h-auto" />
        </div>

        <!-- Step title -->
        <div class="mt-2">
          <h1 class="text-lg font-semibold text-gray-800 dark:text-white">
           {{ step }}
          </h1>
        </div>

      </div>

    </li>
  </ol>
</div>






  
    <!-- MAIN CONTENT: Questions (left/center) + Image & Text (right) -->
    <div
      class="container px-10 mx-auto mt-10 flex flex-col-reverse lg:flex-row 
             justify-center items-center lg:items-start gap-8">
  
      <!-- LEFT/CENTER: Display the current step questions -->
      <div class="w-full lg:w-2/3">
        <!-- We only want one step visible at a time -->
        <ng-container *ngFor="let item of AllQuestions; let i = index">
          <app-playground-step
            *ngIf="display[i]"
            (submissionComplete)="sendRequestForEvaluation()"
            [title]="currentSolution.title"
            [step]="steps[i]"
            [questions]="AllQuestions[i]"
            [questionsTitles]="questionsTitles[i]"
            [stepNumber]="currentIndexDisplay"
            [buttonText]="buttontexts[i]"
            [solutionId]="id"
            (buttonInfoEvent)="updatePlayground($event)">
          </app-playground-step>
        </ng-container>
      </div>
  
      <!-- RIGHT: Step image + “subtitle” for whichever step is active -->
      <div class="w-full lg:w-1/3 flex flex-col items-center lg:items-start mt-10">
        <ng-container *ngFor="let step of steps; let i = index">
          <div *ngIf="display[i]" class="flex flex-col items-center lg:items-start">
            <!-- Step Image -->
            <img
              [src]="'../../../assets/img/step-' + (i + 1) + '.png'"
              alt="Step {{ i + 1 }} image"
              class="w-60 h-auto mb-3" />
  
            <!-- Step subtitle or fallback if only one question -->
            <time
              *ngIf="AllQuestions[i].length > 1"
              class="block mb-2 text-xl font-normal leading-none text-gray-500 dark:text-gray-400">
              {{ subtitles[i] }}
            </time>
            <time
              *ngIf="AllQuestions[i].length == 1"
              class="block mb-2 text-xl font-normal leading-none text-gray-500 dark:text-gray-400">
              Final Review and update order of things
            </time>
            <div *ngIf="isFinalStep(i)" class="w-full mt-4 space-y-3">
              <button
                type="button"
                (click)="requestAiFeedback()"
                [disabled]="aiFeedbackLoading"
                class="w-full inline-flex items-center justify-center rounded-2xl bg-gradient-to-r from-slate-900 via-indigo-600 to-fuchsia-500 px-4 py-3 text-base font-semibold text-white shadow-lg shadow-indigo-500/30 transition disabled:cursor-not-allowed disabled:opacity-60">
                <ng-container *ngIf="!aiFeedbackLoading; else feedbackLoading">
                  Get AI Feedback
                </ng-container>
                <ng-template #feedbackLoading>
                  <span class="flex items-center gap-2">
                    <svg
                      class="h-4 w-4 animate-spin text-white"
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      aria-hidden="true">
                      <circle
                        class="opacity-25"
                        cx="12"
                        cy="12"
                        r="10"
                        stroke="currentColor"
                        stroke-width="4"></circle>
                      <path
                        class="opacity-75"
                        fill="currentColor"
                        d="M4 12a8 8 0 018-8v4l3-3-3-3v4a8 8 0 00-8 8h4z"></path>
                    </svg>
                    <span>Reviewing…</span>
                  </span>
                </ng-template>
              </button>
              <p
                *ngIf="aiFeedbackStatus"
                class="text-sm text-gray-600 dark:text-gray-300">
                {{ aiFeedbackStatus }}
              </p>
              <div
                *ngIf="aiFeedbackError"
                class="rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700 dark:border-red-500/40 dark:bg-red-500/10 dark:text-red-200">
                {{ aiFeedbackError }}
              </div>
              <div
                *ngIf="aiFeedbackText"
                class="w-full rounded-2xl border border-indigo-200 bg-white/80 p-4 shadow-md backdrop-blur dark:border-indigo-500/40 dark:bg-slate-900/60">
                <div class="mb-2 flex items-center gap-2 text-indigo-900 dark:text-indigo-200">
                  <svg
                    class="h-5 w-5"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="1.5">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <h3 class="text-base font-semibold">AI Evaluation</h3>
                </div>
                <div
                  class="text-sm leading-relaxed text-gray-800 whitespace-pre-wrap dark:text-gray-100">
                  {{ aiFeedbackText }}
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
  
