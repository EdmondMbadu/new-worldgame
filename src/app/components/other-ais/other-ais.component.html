<div class="dark:bg-slate-900 min-h-screen min-w-max">
    <!--  Navbar (unchanged)  -->
    <div *ngIf="!isLoggedIn">
      <app-navbar></app-navbar>
    </div>
    <div *ngIf="isLoggedIn">
      <app-navbar
        [hoveredOtherAisPath]="'bg-gray-100 dark:bg-gray-700'"
        [showMoreOrLess]="true"
        [email]="this.auth.currentUser.email"
        [firstName]="this.auth.currentUser.firstName"
        [lastName]="this.auth.currentUser.lastName"
        [path]="'home'">
      </app-navbar>
    </div>
  
    <!--  Page layout  -->
    <div class="container flex flex-col lg:flex-row mx-auto justify-center md:justify-between bg-gray-100 mt-30 dark:bg-slate-900">
      <div class="flex flex-col mx-auto items-center mt-20 mb-8">
  
        <!--  AI picker (unchanged)  -->
        <button
          (click)="toggleAiOptions()"
          id="dropdownNotificationButton"
          class="relative inline-flex items-center text-sm font-medium text-center text-gray-500 hover:text-gray-900 focus:outline-none dark:hover:text-white dark:text-gray-400"
          type="button">
          <h1 class="mx-4 text-xl font-bold">Choose Your AI</h1>
          <svg class="w-3 h-3 ms-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4" />
          </svg>
        </button>
  
        <div class="flex flex-row">
          <a
            *ngFor="let ai of aiOptions"
            (click)="selectAi(ai)"
            class="cursor-pointer px-4 py-3 hover:bg-gray-300 dark:hover:bg-gray-700">
            <div>
              <img class="rounded-full h-16" [src]="ai.avatarPath" alt="AI avatar">
              <span class="font-semibold text-sm text-gray-900 dark:text-white">{{ ai.name }}</span>
            </div>
          </a>
        </div>
  
        <!--  Dropdown menu (unchanged)  -->
        <div
          *ngIf="allAIOptions"
          id="dropdownNotification"
          class="z-50 w-full max-w-sm bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-800 dark:divide-gray-700"
          aria-labelledby="dropdownNotificationButton">
          <div class="block px-4 py-2 font-medium text-center text-gray-700 rounded-t-lg bg-gray-50 dark:bg-gray-800 dark:text-white">
            AIs
          </div>
          <div class="divide-y divide-gray-100 dark:divide-gray-700">
            <a
              *ngFor="let ai of aiOptions"
              (click)="selectAiFromDropDown(ai)"
              class="cursor-pointer flex px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700">
              <div class="flex-shrink-0">
                <img class="rounded-full w-20" [src]="ai.avatarPath" alt="AI avatar">
              </div>
              <div class="w-full ps-3">
                <div class="text-gray-500 text-sm mb-1.5 dark:text-gray-400">
                  <span class="font-semibold text-gray-900 dark:text-white">{{ ai.name }}</span>: {{ ai.intro }}
                </div>
              </div>
            </a>
          </div>
        </div>
  
        <!--  CHAT AREA  -->
        <div class="flex flex-col mx-auto items-center mt-4 mb-4 max-w-4xl">
          <section class="conversation-window">
            <!-- scrollable messages -->
            <section class="responses" #chatMessages>
              <ng-container *ngFor="let resp of responses; let i = index">
                <div
                  [ngClass]="resp.type === 'PROMPT' ? 'prompt' : 'response'"
                  class="relative group">
              
                  <!-- Avatar for AI responses -->
                  <img
                    *ngIf="resp.type !== 'PROMPT'"
                    class="chatbot-logo"
                    [src]="aiSelected.avatarPath" />
              
                  <!-- Copy button (only on AI responses) -->
                  <button
                    *ngIf="resp.type === 'RESPONSE'"
                    (click)="copyToClipboard(resp.text)"
                    aria-label="Copy answer"
                    class="absolute top-1 right-1 p-1 rounded
                           invisible group-hover:visible
                           hover:bg-gray-200 dark:hover:bg-gray-700
                           transition">
              
                    <!-- Heroicons-outline clipboard icon -->
                    <svg class="w-5 h-5 text-gray-600 dark:text-gray-300"
                         fill="none" stroke="currentColor" stroke-width="2"
                         stroke-linecap="round" stroke-linejoin="round"
                         viewBox="0 0 24 24">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                      <path d="M5 15H4a2 2 0 0 1-2-2V4
                               c0-1.1.9-2 2-2h9a2 2 0 0 1 2 2v1" />
                    </svg>
                    
                  </button>
              
                  <!-- Text blocks -->
                  <p *ngIf="i === 0">
                    <span class="font-bold">{{ aiSelected.name }}</span><br />
                    {{ aiSelected.intro }}
                  </p>
              
                  <p *ngIf="i !== 0"
                     class="select-text"           
                     [innerHTML]="chat.formatText(resp.text)">
                  </p>
                </div>
              </ng-container>
              
  
              <!-- sentinel element -->
              <div #bottomAnchor></div>
            </section>
  
            <!-- prompt area fixed at the bottom -->
            <section class="prompt-area">
              <form *ngIf="!status" class="prompt-form">
                <input
                  class="prompt-input"
                  type="text"
                  #promptText
                  placeholder="Enter a prompt here"
                  autofocus />
  
                <button type="button" (click)="submitPrompt($event, promptText)">
                  <svg class="w-[36px] h-[36px] text-gray-800 hover:fill-green-400"
                       xmlns="http://www.w3.org/2000/svg" fill="none"
                       viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round"
                          stroke-linejoin="round" stroke-width="2"
                          d="m12 18-7 3 7-18 7 18-7-3Zm0 0v-5"/>
                  </svg>
                </button>
              </form>
  
              <div *ngIf="status" class="status-indicator">{{ status }}</div>
            </section>
          </section>
        </div>
      </div>
    </div>
  </div>
  